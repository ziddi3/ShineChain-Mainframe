<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShineChain Library - Infinite Knowledge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            overflow: hidden;
            background: #0a0a0a;
        }

        #library-canvas {
            display: block;
            width: 100%;
            height: 100vh;
            cursor: crosshair;
        }

        .hud {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #FFD700;
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #FFD700;
            z-index: 1000;
        }

        .controls-info {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: #00ffff;
            padding: 15px 30px;
            border-radius: 20px;
            border: 2px solid #00ffff;
            text-align: center;
            font-family: 'Courier New', monospace;
            z-index: 1000;
        }

        .secret-door-hint {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(138, 43, 226, 0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            text-align: center;
            font-size: 20px;
            z-index: 2000;
            display: none;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #FFD700;
            font-size: 24px;
            z-index: 3000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 215, 0, 0.3);
            border-top-color: #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div>Loading the Infinite Library...</div>
    </div>

    <div class="hud">
        <div>ðŸ“š ShineChain Library</div>
        <div id="position">Position: (0, 0, 0)</div>
        <div id="hint">Explore to find the secret passage...</div>
    </div>

    <div class="controls-info">
        <strong>Controls:</strong> WASD/Arrow Keys = Move | Mouse = Look Around | E = Interact | ESC = Menu
    </div>

    <div class="secret-door-hint" id="doorHint">
        ðŸšª Press E to open the mysterious door
    </div>

    <canvas id="library-canvas"></canvas>

    <!-- Three.js for 3D rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Card System -->
    <script src="assets/cards/card-data.js"></script>
    <script src="assets/cards/card-system.js"></script>
    <script src="assets/cards/card-placer.js"></script>

    <script>
        // 3D Library Scene Setup
        let scene, camera, renderer, controls;
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
        let velocity = new THREE.Vector3();
        let direction = new THREE.Vector3();
        let playerPosition = new THREE.Vector3(0, 1.6, 0);
        let yaw = 0, pitch = 0;
        let isNearDoor = false;
        let secretDoorPosition = new THREE.Vector3(0, 0, -30);

        // Initialize scene
        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x0a0a0a, 10, 50);

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.copy(playerPosition);

            // Renderer
            renderer = new THREE.WebGLRenderer({ 
                canvas: document.getElementById('library-canvas'),
                antialias: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);

            // Warm library lights
            const lights = [];
            for (let i = 0; i < 8; i++) {
                const light = new THREE.PointLight(0xFFD700, 0.8, 20);
                light.position.set(
                    (i % 4 - 1.5) * 10,
                    3,
                    Math.floor(i / 4) * -20 - 5
                );
                light.castShadow = true;
                scene.add(light);
                lights.push(light);
            }

            // Floor
            const floorGeometry = new THREE.PlaneGeometry(50, 50);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x2a1810,
                roughness: 0.8,
                metalness: 0.2
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Ceiling
            const ceiling = floor.clone();
            ceiling.position.y = 5;
            ceiling.rotation.x = Math.PI / 2;
            scene.add(ceiling);

            // Create bookshelves
            createBookshelves();

            // Create hallway to secret room
            createHallway();

            // Create secret door
            createSecretDoor();

            // Add decorative elements
            addDecorations();

            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 1000);

            // Event listeners
            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            document.addEventListener('mousemove', onMouseMove);
            window.addEventListener('resize', onWindowResize);

            // Lock pointer on click
            document.getElementById('library-canvas').addEventListener('click', () => {
                document.getElementById('library-canvas').requestPointerLock();
            });

            animate();
        }

        function createBookshelves() {
            const shelfMaterial = new THREE.MeshStandardMaterial({ color: 0x4a2511 });
            const bookMaterials = [
                new THREE.MeshStandardMaterial({ color: 0x8B4513 }),
                new THREE.MeshStandardMaterial({ color: 0x654321 }),
                new THREE.MeshStandardMaterial({ color: 0x3d2817 }),
                new THREE.MeshStandardMaterial({ color: 0x5c4033 })
            ];

            // Create rows of bookshelves
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < 4; col++) {
                    if (col === 1 && row === 1) continue; // Leave center open

                    const shelfGroup = new THREE.Group();
                    
                    // Shelf structure
                    const shelfGeometry = new THREE.BoxGeometry(4, 4, 0.5);
                    const shelf = new THREE.Mesh(shelfGeometry, shelfMaterial);
                    shelf.castShadow = true;
                    shelf.receiveShadow = true;
                    shelfGroup.add(shelf);

                    // Add books
                    for (let i = 0; i < 20; i++) {
                        const bookGeometry = new THREE.BoxGeometry(
                            0.15 + Math.random() * 0.1,
                            0.3 + Math.random() * 0.2,
                            0.4
                        );
                        const book = new THREE.Mesh(
                            bookGeometry,
                            bookMaterials[Math.floor(Math.random() * bookMaterials.length)]
                        );
                        book.position.set(
                            -1.8 + (i * 0.2),
                            -1.5 + Math.floor(i / 10) * 0.8,
                            0.05
                        );
                        book.rotation.y = (Math.random() - 0.5) * 0.2;
                        shelfGroup.add(book);
                    }

                    shelfGroup.position.set(
                        (col - 1.5) * 8,
                        2,
                        (row - 1) * -10
                    );
                    scene.add(shelfGroup);
                }
            }
        }

        function createHallway() {
            const hallwayMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x1a1a1a,
                roughness: 0.9
            });

            // Hallway walls
            const wallGeometry = new THREE.BoxGeometry(0.5, 5, 15);
            
            const leftWall = new THREE.Mesh(wallGeometry, hallwayMaterial);
            leftWall.position.set(-2, 2.5, -32.5);
            leftWall.castShadow = true;
            scene.add(leftWall);

            const rightWall = leftWall.clone();
            rightWall.position.set(2, 2.5, -32.5);
            scene.add(rightWall);

            // Hallway lights
            for (let i = 0; i < 3; i++) {
                const light = new THREE.PointLight(0x8A2BE2, 0.6, 10);
                light.position.set(0, 4, -25 - i * 5);
                scene.add(light);
            }
        }

        function createSecretDoor() {
            const doorGroup = new THREE.Group();

            // Door frame
            const frameMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x4a2511,
                roughness: 0.7
            });
            const frameGeometry = new THREE.BoxGeometry(3, 4, 0.3);
            const frame = new THREE.Mesh(frameGeometry, frameMaterial);
            doorGroup.add(frame);

            // Door itself
            const doorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x2a1810,
                roughness: 0.8,
                metalness: 0.3
            });
            const doorGeometry = new THREE.BoxGeometry(2.5, 3.5, 0.2);
            const door = new THREE.Mesh(doorGeometry, doorMaterial);
            door.name = 'secretDoor';
            doorGroup.add(door);

            // Door handle
            const handleGeometry = new THREE.SphereGeometry(0.1, 16, 16);
            const handleMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xFFD700,
                metalness: 0.9,
                roughness: 0.1
            });
            const handle = new THREE.Mesh(handleGeometry, handleMaterial);
            handle.position.set(1, 0, 0.15);
            doorGroup.add(handle);

            // Mysterious glow
            const glowLight = new THREE.PointLight(0x8A2BE2, 1, 5);
            glowLight.position.set(0, 0, 0.5);
            doorGroup.add(glowLight);

            doorGroup.position.copy(secretDoorPosition);
            doorGroup.position.y = 2;
            scene.add(doorGroup);
        }

        function addDecorations() {
            // Add some floating particles
            const particleGeometry = new THREE.BufferGeometry();
            const particleCount = 100;
            const positions = new Float32Array(particleCount * 3);

            for (let i = 0; i < particleCount * 3; i++) {
                positions[i] = (Math.random() - 0.5) * 50;
            }

            particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const particleMaterial = new THREE.PointsMaterial({
                color: 0xFFD700,
                size: 0.05,
                transparent: true,
                opacity: 0.6
            });

            const particles = new THREE.Points(particleGeometry, particleMaterial);
            scene.add(particles);
        }

        function onKeyDown(event) {
            switch (event.code) {
                case 'KeyW':
                case 'ArrowUp':
                    moveForward = true;
                    break;
                case 'KeyS':
                case 'ArrowDown':
                    moveBackward = true;
                    break;
                case 'KeyA':
                case 'ArrowLeft':
                    moveLeft = true;
                    break;
                case 'KeyD':
                case 'ArrowRight':
                    moveRight = true;
                    break;
                case 'KeyE':
                    if (isNearDoor) {
                        openSecretDoor();
                    }
                    break;
            }
        }

        function onKeyUp(event) {
            switch (event.code) {
                case 'KeyW':
                case 'ArrowUp':
                    moveForward = false;
                    break;
                case 'KeyS':
                case 'ArrowDown':
                    moveBackward = false;
                    break;
                case 'KeyA':
                case 'ArrowLeft':
                    moveLeft = false;
                    break;
                case 'KeyD':
                case 'ArrowRight':
                    moveRight = false;
                    break;
            }
        }

        function onMouseMove(event) {
            if (document.pointerLockElement === document.getElementById('library-canvas')) {
                yaw -= event.movementX * 0.002;
                pitch -= event.movementY * 0.002;
                pitch = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, pitch));
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function updateMovement(delta) {
            velocity.x -= velocity.x * 10.0 * delta;
            velocity.z -= velocity.z * 10.0 * delta;

            direction.z = Number(moveForward) - Number(moveBackward);
            direction.x = Number(moveRight) - Number(moveLeft);
            direction.normalize();

            if (moveForward || moveBackward) velocity.z -= direction.z * 20.0 * delta;
            if (moveLeft || moveRight) velocity.x -= direction.x * 20.0 * delta;

            // Apply rotation
            const rotatedVelocity = velocity.clone();
            rotatedVelocity.applyAxisAngle(new THREE.Vector3(0, 1, 0), yaw);

            playerPosition.add(rotatedVelocity.multiplyScalar(delta));

            // Boundaries
            playerPosition.x = Math.max(-20, Math.min(20, playerPosition.x));
            playerPosition.z = Math.max(-40, Math.min(5, playerPosition.z));

            camera.position.copy(playerPosition);
            camera.rotation.set(pitch, yaw, 0, 'YXZ');

            // Check if near door
            const distanceToDoor = playerPosition.distanceTo(secretDoorPosition);
            isNearDoor = distanceToDoor < 3;
            document.getElementById('doorHint').style.display = isNearDoor ? 'block' : 'none';

            // Update HUD
            document.getElementById('position').textContent = 
                `Position: (${playerPosition.x.toFixed(1)}, ${playerPosition.y.toFixed(1)}, ${playerPosition.z.toFixed(1)})`;
        }

        function openSecretDoor() {
            // Transition to secret room
            document.body.style.transition = 'opacity 1s';
            document.body.style.opacity = '0';
            
            setTimeout(() => {
                window.location.href = 'secret-room.html';
            }, 1000);
        }

        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            
            const delta = clock.getDelta();
            updateMovement(delta);
            
            renderer.render(scene, camera);
        }

        // Initialize when page loads
        window.addEventListener('load', init);

        // Place collectible cards in the library
        window.addEventListener('load', () => {
            setTimeout(() => {
                // Place cards in various locations
                cardPlacer.placeCard('card_001', {
                    position: 'fixed',
                    top: '15%',
                    left: '10%',
                    rotation: 15
                });

                cardPlacer.placeCard('card_006', {
                    position: 'fixed',
                    bottom: '20%',
                    right: '15%',
                    rotation: -20
                });
            }, 2000);
        });
    </script>
</body>
</html>